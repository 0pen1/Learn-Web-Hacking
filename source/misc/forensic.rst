溯源取证
================================

攻击分析
--------------------------------
在运维时，从日志中获取信息是十分有必要的，通常可以从日志中发现成功或未成功的入侵行为。一个是从User Agent入手，一些工具都会有比较明显的User Agent，比如awvs / burpsuite / w3af / nessus / openvas 等。

另外，可以针对每种攻击进行关键字匹配，比如select/alert/eval等。

还有连续的404或者500也可能是攻击者在进行尝试。

溯源常见流程
--------------------------------
- 源码分析，检查源码改动
- 查杀后门
- 查看日志
- ``w`` 命令，查看用户及其进程
- 分析开机自启程序
    - ``/etc/init.d``
    - ``~/.bashrc``
- 查看端口占用

重点分析文件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- ``/var/log/wtmp`` 登录进入，退出，数据交换、关机和重启纪录
- ``/var/run/utmp`` 有关当前登录用户的信息记录
- ``/var/log/lastlog`` 文件记录用户最后登录的信息，可用 lastlog 命令来查看。
- ``/var/log/secure`` 记录登入系统存取数据的文件，例如 pop3/ssh/telnet/ftp 等都会被记录。
- ``/var/log/cron`` 与定时任务相关的日志信息
- ``/var/log/message`` 系统启动后的信息和错误日志
- ``/var/log/apache2/access.log`` apache access log
- ``/etc/passwd`` 用户列表
- ``~/.ssh``

溯源关联分析方法
--------------------------------

文档类
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- hash
- ssdeep
- 版本信息（公司/作者/最后修改作者/创建时间/最后修改时间）

可执行文件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- 特殊端口
- 特殊字符串/密钥
- PDB文件路径

清除日志方式
--------------------------------
- ``kill <bash process ID>`` 不会存储
- ``set +o history`` 不写入历史记录
- ``unset HISTFILE`` 清除历史记录的环境变量

参考链接
--------------------------------
- `Web日志安全分析系统实践 <https://xz.aliyun.com/t/2136>`_
- `Web日志安全分析浅谈 <https://xz.aliyun.com/t/1121>`_
- `大型互联网企业入侵检测实战总结 <https://xz.aliyun.com/t/1626/>`_
- `同程入侵检测系统 <https://mp.weixin.qq.com/s/kzeAEvz-ejLD71fgb5t8tA>`_


参考链接
---------------------------------------------
- `取证入门 web篇 <http://www.freebuf.com/column/147929.html>`_
